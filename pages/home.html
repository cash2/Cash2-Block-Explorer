<style>
  #mem_pool_rows tr td:first-child {
    text-align: left;
  }
</style>

<div class="hidden col-sm-6 col-md-6">
  <div class="panel panel-default">
    <div class="panel-heading">
    
    <h3 class="panel-title"><i class="fa fa-area-chart" aria-hidden="true"></i>
      Charts
      <span class="text-default" data-placement="right" data-original-title="Difficulty based on last blocks from the list below. Block size, transactions count. Load more blocks to enlarge chart range."><i class="fa fa-question-circle"></i></span>
    </h3>
    
    </div>
    <div class="panel-body chart-wrapper">
    <canvas id="difficultyChart" height="250"></canvas>
    </div>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="bold dark col-centered">Blocks</h3>
  </div>
  <br/>
  <br/>
  <div class="panel-body">
  <div class="hidden row">
    <div class="col-sm-8 col-md-6 col-lg-5">
      <div class="input-group">
        <a id="prev-page" href="#" class="btn btn-default input-group-addon"><i class="fa fa-arrow-left" aria-hidden="true"></i> Older</a>
        <span class="input-group-addon">â„–</span>
        <input id="goto-height" type="text" class="form-control" placeholder="Height">
        <a id="goto-height-go" href="#" class="btn btn-default input-group-addon">Go</a>
        <a id="next-page" href="#" class="btn btn-default input-group-addon disabled">Newer <i class="fa fa-arrow-right" aria-hidden="true"></i></a>
      </div>
    </div>
  </div>

  <div class="col-sm-8 col-md-6 col-lg-6 col-centered table-responsive">
    <table class="table table-fixed">
      <thead>
      <tr>
        <th><i class="fa fa-clock-o"></i>Time</th>
        <th><i class="fa fa-bars"></i>Height</th>
        <th class="hidden"><i class="fa fa-archive"></i> Size</th>
        <th class="hidden"><i class="fa fa-paw"></i> Block Hash</th>
        <th class="hidden"><i class="fa fa-unlock-alt"></i> Difficulty</th>
        <th class="hidden"><i class="fa fa fa-exchange"></i> Txs</th>
      </tr>
      </thead>
      <tbody id="blocks_rows">

      </tbody>
    </table>
  </div>

  <br/>

  <span id="loadMoreBlocks" class="text-center">More Blocks</span>
  
  </div>
</div>

<br/>

<div id="mempoolDiv" class="panel panel-default">
  <div class="panel-heading">
    <h3 class="bold dark col-centered">Mempool</h3>
  </div>
  <br/>
  <br/>
  <div class="panel-body">
    <div class="hidden row">
      <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
      <div class="panel panel-default tab-panel">
        <div class="panel-body">
          <ul class="nav nav-pills nav-stacked">
          <li data-placement="bottom" data-original-title="">Count: <span id="mempool_count"></span></li>
          </ul>
        </div>
      </div>
      </div>
      <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
      <div class="panel panel-default tab-panel">
        <div class="panel-body">
          <ul class="nav nav-pills nav-stacked">
            <li data-placement="bottom" data-original-title="">Total Amount: <span id="mempool_amount"></span></li>
          </ul>
        </div>
      </div>
      </div>
      <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
      <div class="panel panel-default tab-panel">
        <div class="panel-body">
        
          <ul class="nav nav-pills nav-stacked">
          <li href="javascript:void(0);" data-placement="bottom" data-original-title="">Total Fees: <span id="mempool_fees"></span></a></li>
          </ul>
        
        </div>
      </div>
      </div>
      <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
        <div class="panel panel-default tab-panel">
          <div class="panel-body">
          
            <ul class="nav nav-pills nav-stacked">
            <li data-placement="bottom" data-original-title="">Total Size: <span id="mempool_sizes"></span></li>
            </ul>
         
          </div>
      </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table" id="mem_pool_table">
        <tr>
          <th>Time</th>
          <th>Amount</th>
          <!-- <th width="10%"><i class="fa fa-tag"></i> Fee</th> -->
          <!-- <th width="10%"><i class="fa fa-archive"></i> Size</th> -->
          <th>Hash</th>
        </tr>
        <tbody id="mem_pool_rows"></tbody>
      </table>
    </div>
  </div>
</div>

<br/>
<br/>

<div>
  <div class="panel-heading">
    <h3 class="bold dark col-centered">Network Stats</h3>
  </div>
  <br/>
  <br/>
  <div class="col-lg-6 col-centered" id="network-stats">
    <table class="table">
      <tr>
        <td>Block Time</td>
        <td id="avgSolveTime"></td>
      </tr>
      <tr>
        <td>Hash Rate</td>
        <td id="avgHashrate"></td>
      </tr>
      <tr>
        <td>Average Difficulty</td>
        <td id="avgDifficulty"></td>
      </tr>
      <tr>
        <td>Current Reward</td>
        <td id="currentReward"></td>
      </tr>
      <tr>
        <td>Circulating Supply</td>
        <td id="totalCoins"></td>
      </tr>
      <tr>
        <td>Emission</td>
        <td><span id="emissionPercent"></span> %</td>
      </tr>
    </table>
  </div>
</div>

<br/>
<br/>

<div id="checkPaymentDiv">
  <h3 class="dark bold col-centered">Check Payment</h3>
  <br/>
  <br/>
  <div class="well bs-component">
    <form class="form-horizontal" id="check_tx_form">
        <fieldset>
        <div class="col-md-12">
          <div class="form-group">
            <label>Transaction ID</label>
            <input class="form-control" id="transaction_hash" style="margin: 0 auto; text-align: center; width: 75%;">
            <br/>
            <label>Transaction Secret Key</label>
            <input class="form-control" id="private_key" style="margin: 0 auto; text-align: center; width: 75%;">
            <br/>
            <label>Receiver's Address</label>
            <input class="form-control" id="public_address" style="margin: 0 auto; text-align: center; width: 75%;">
          </div>
        </div>
        <br/>
        <div class="col-md-12">
          <div class="form-group">
            <button class="btn btn-primary" type="button" id="check_transaction" style="">
              <span class="fa fa-search"> Check Payment</span>
            </button>
          </div>
        </div>
        </fieldset>
    </form>
  </div>

  <br/>

  <div id="check_result">
   <div class="panel panel-default">
    <div class="panel-heading">
    
      <h3>Address</h3>
      <h3 id="receiverAddress" style="word-wrap: break-word; padding-left: 25px; padding-right: 25px;"></h3>
      <h3>Received</h3>
      <h3 id="receivedAmount"></h3>

      <!-- <h3><span id="transactionHash" style="word-break: break-all;"></span></h3> -->
    </div>

<!--

    <div class="row" id="tx_info">
      <div class="col-md-12 stats">
        <div id="confirmations" style="display: none;"><span data-toggle="tooltip" data-placement="right" data-original-title="The number of network confirmations."><i class="fa fa-question-circle"></i></span> Confirmations: <span id="transaction.confirmations"></span>, First confirmation time: <span id="transaction.timestamp"></span> (<time class="transaction-timeago"></time>)</div>
        <div><span data-toggle="tooltip" data-placement="right" data-original-title="Money that goes to the miner, who included this transaction into block."><i class="fa fa-question-circle"></i></span> Fee: <span id="transaction.fee"></span></div>
        <div><span data-toggle="tooltip" data-placement="right" data-original-title="It does not mean that this is the amount that is actually transferred."><i class="fa fa-question-circle"></i></span> Sum of outputs: <span id="transaction.amount_out"></span></div>
        <div><span data-toggle="tooltip" data-placement="right" data-original-title="Size of the transaction in bytes."><i class="fa fa-question-circle"></i></span> Size: <span id="transaction.size"></span></div>
        <div id="div_transaction_paymentId"><span data-toggle="tooltip" data-placement="right" data-original-title="Optional user-defined hexadecimal characters string. Can be used by anyone to distinguish the transactions easier."><i class="fa fa-question-circle"></i></span> Payment ID: <span id="transaction.paymentId"></span>
        <br />
        Patment ID decoding: <em id="transaction.paymentIdDecifer"></em></div>
        <div id="div_transaction_mixin"><span data-toggle="tooltip" data-placement="right" data-original-title="Denotes how many random inputs are mixed within this transactions in order to achieve desired level of anonimity. Mixin count 1 means no additional inputs are mixed in and thus each input can be traced back."><i class="fa fa-question-circle"></i></span> Mixin count: <span id="transaction.mixin"></span></div>
        <div id="tx_unconfirmed" style="display: none;"><span data-toggle="tooltip" data-placement="right" data-original-title="The transaction is not included into block yet and therefore is not wtitten into blockchain."><i class="fa fa-question-circle"></i></span> <span class="text-warning">Unconfirmed transaction</span></div>
      </div>
    </div>
    <div id="tx_block">
      <h3><i class="fa fa-cube fa-fw" aria-hidden="true"></i> In block</h3>
      <div class="row">
        <div class="col-md-12 stats">
          <div><i class="fa fa-circle-o"></i> Hash: <span id="block.hash" style="word-break: break-all;"></span></div>
          <div><i class="fa fa-circle-o"></i> Height: <span id="block.height"></span></div>
          <div><i class="fa fa-circle-o"></i> Timestamp: <span id="block.timestamp"></span></div>
        </div>
      </div>
    </div>

    <h3 class="inputs">Inputs (<span id="inputs_count"></span>) <button class="btn btn-default collapsed" data-toggle="collapse" data-target="#collapsibleInputs">Show/Hide</button></h3>
    <div class="table-responsive collapse" id="collapsibleInputs">
      <table class="table table-hover">
        <thead>
        <tr>
          <th><i class="fa fa-money"></i> Amount</th>
          <th><i class="fa fa-paw"></i> Image</th>
          <th><i class="fa fa-arrows-alt"></i> Offset</th>
        </tr>
        </thead>
        <tbody id="inputs_rows">

        </tbody>
      </table>
    </div>


    <h3 class="outputs">Outputs (<span id="outputs_count"></span>)</h3>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
        <tr>
          <th><i class="fa fa-money"></i> Amount</th>
          <th><i class="fa fa-key"></i> Key</th>
        </tr>
        </thead>
        <tbody id="outputs_rows">

        </tbody>
      </table>
    </div>

-->
  </div>
</div>

<div>
  <h3 id="check_result_error"></h3>
</div>

<div class="hidden">
  <p>Height<br/><span id="networkHeight"></span></p>
  <p>Transactions<br/><span id="networkTransactions"></span></p>
  <p>Min. fee<br/><span id="minimumFee">0</span></p>
  <p>Next Difficulty<br/><span id="networkDifficulty"></span></p>
  <p>Hash Rate<br/><span id="networkHashrate"></span></p>
  <p>Est. solve time<br/><span id="blockSolveTime"></span></p>
</div>

<script>
  // home.html

  var CASH2_HARD_FORK_HEIGHT_2 = 420016;

  var block,
  Difficulties = [],
  Blocks = [],
  Rewards = [],
  Txses = [],
  Sizes = [],
  Timestamps = [],
  time_stamps = [],
  Solvetimes = [],
  diffChart,
  refresh = true;

  currentPage = {
    destroy: function() {
      if (xhrGetBlocks)
      {
        xhrGetBlocks.abort();
      }
    },
    init: function() {
      $.when(
        renderInitialBlocks()
      ).then( function() {
        setTimeout(function() {
          $.when(
            displayDiffChart()
          ).then(function() {
            setTimeout(function() {
              refreshChart();
            }, 100)
          });
        }, 500)
      });
    },
    update: function() {
      renderLastBlock();
      updateText('networkHeight', lastStats.height.toString());
      updateText('networkTransactions', lastStats.tx_count.toString());
      updateText('networkHashrate', getReadableHashRateString(lastStats.difficulty / blockTargetInterval));
      updateText('networkDifficulty', getReadableDifficultyString(lastStats.difficulty, 2).toString());
      $("time.timeago").timeago();
      getPoolTransactions();
      var currHeight = $('#blocks_rows').children().first().data('height');
      if(refresh)
      {
        $.when(
          renderInitialBlocks()
        ).then(function() {
          setTimeout(function() {
            refreshChart();
          }, 100)
        });
      }

      if ((currHeight + 31) < lastStats.last_known_block_index)
      {
        $('#next-page').removeClass('disabled');
      }
    }
  };

  function renderLastBlock()
  {
    $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc:"2.0",
        id: "test",
        method:"getlastblockheader",
        params: {}
      }),
      dataType: 'json',
      cache: 'false',
      success: function(data) {
        last_block_hash = data.result.block_header.hash;
        $.ajax({
          url: api + '/json_rpc',
          method: "POST",
          data: JSON.stringify({
            jsonrpc:"2.0",
            id: "test",
            method:"f_block_json",
            params: {
                hash: last_block_hash
            }
          }),
          dataType: 'json',
          cache: 'false',
          success: function(data) {
            block = data.result.block;
            updateText('totalCoins', getReadableCoins(block.alreadyGeneratedCoins, 0));
            updateText('emissionPercent', (block.alreadyGeneratedCoins / 15000000000000000 * 100).toFixed(2));
            updateText('currentReward', getReadableCoins(block.baseReward, 9));
          }
        });
      }
    });
  }

  var xhrGetBlocks;
  $('#loadMoreBlocks').click(function() {
    if (xhrGetBlocks)
    {
      xhrGetBlocks.abort();
    }

    xhrGetBlocks = $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc:"2.0",
        id: "test",
        method:"f_blocks_list_json",
        params: {
            height: $('#blocks_rows').children().last().data('height')
        }
      }),
      dataType: 'json',
      cache: 'false',
      success: function(data) {
        $.when(
           renderBlocks(data.result.blocks)
        ).then(function() {
          setTimeout(function() {
            loadMoreChart();
          }, 100)
        });
      }
    });
  });

  $('#prev-page').click(function(e) {
    refresh = false;
    if (xhrGetBlocks)
    {
      xhrGetBlocks.abort();
    }

    var currHeight = $('#blocks_rows').children().first().data('height');
    var openHeight = (currHeight - 31 < 0) ? 0 : currHeight - 31;
    
    xhrGetBlocks = $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc:"2.0",
        id: "test",
        method:"f_blocks_list_json",
        params: {
          height: openHeight
        }
      }),
      dataType: 'json',
      cache: 'false',
      success: function(data) {
        $('#blocks_rows').children().remove();
        $.when(
          renderBlocks(data.result.blocks)
        ).then(function() {
          setTimeout(function() {
            refreshChart();
          }, 100)
        });
      }
    });

    e.preventDefault();
    
    if ((currHeight + 31) > lastStats.last_known_block_index)
    {
      $('#next-page').removeClass('disabled');
    }

    if ((currHeight - 61) < 0)
    {
      $('#prev-page').addClass('disabled');
    }
  });

  $('#next-page').click(function(e) {
    refresh = false;
    if (xhrGetBlocks)
    {
      xhrGetBlocks.abort();
    }

    var currHeight = $('#blocks_rows').children().first().data('height');
    var openHeight = (currHeight + 31 > lastStats.last_known_block_index) ? (lastStats.last_known_block_index) : currHeight + 31;
    
    xhrGetBlocks = $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc:"2.0",
        id: "test",
        method:"f_blocks_list_json",
        params: {
            height: openHeight
        }
      }),
      dataType: 'json',
      cache: 'false',
      success: function(data) {
        $('#blocks_rows').children().remove();
        $.when(
          renderBlocks(data.result.blocks)
        ).then(function() {
          setTimeout(function() {
            refreshChart();
          }, 100)
        });      
      }
    });

    e.preventDefault();
    
    if ((currHeight + 61) > lastStats.last_known_block_index)
    {
      $('#next-page').addClass('disabled');
      refresh = true;
    }
    
    $('#prev-page').removeClass('disabled');
    
  });

  $('#goto-height-go').click(function() {
    var height = document.getElementById('goto-height').value;
    var newUrl = "/?height="+height;
    window.location = newUrl;
  });

  $('#goto-height').keyup(function(e) {
    if (e.keyCode === 13)
    {
      $('#goto-height-go').click();
    }
  });

  function renderInitialBlocks()
  {
    if (xhrGetBlocks)
    {
      xhrGetBlocks.abort();
    }
  
    var loadHeight;
  
    if (urlParam('height'))
    {
      loadHeight = parseInt(urlParam('height'));
    }
    else
    {
      loadHeight = lastStats.height - 1;
    }
  
    if ((loadHeight - 31) < 0)
    {
      $('#prev-page').addClass('disabled');
      $('#next-page').removeClass('disabled');
    }
  
    xhrGetBlocks = $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc:"2.0",
        id: "test",
        method:"f_blocks_list_json",
        params: {
          height: loadHeight
        }
      }),
      dataType: 'json',
      cache: 'false',
      success: function(data) {
        renderBlocks(data.result.blocks);
      }
    });
  }

  function getBlockRowElement(block, jsonString)
  {
    var row = document.createElement('tr');
    row.setAttribute('data-json', jsonString);
    row.setAttribute('data-height', block.height);
    row.setAttribute('id', 'blockRow' + block.height);
    <!-- row.setAttribute('title', block.hash); -->
    var dateTime = new Date(block.timestamp * 1000).toISOString();
    row.setAttribute('data-dt', dateTime);
    var columns =
      '<td class="date-time">' + formatDate(block.timestamp) +
      '<td>' + formatBlockLink(block.hash, block.height) + '</td>';

    var blockDifficulty = block.difficulty;

    if (block.height >= CASH2_HARD_FORK_HEIGHT_2)
    {
      blockDifficulty = block.difficulty * 1099511627776;
    }

    Difficulties.push(parseInt(blockDifficulty));
    Blocks.push(parseInt(block.height));
    Txses.push(parseInt(block.tx_count));
    Sizes.push(parseInt(block.cumul_size));
    Timestamps.push(dateTime);
    time_stamps.push(block.timestamp);

    row.innerHTML = columns;

    return row;
  }

  function renderBlocks(blocksResults)
  {
    var $blocksRows = $('#blocks_rows');

    for (var i = 0; i < blocksResults.length; i ++)
    {
      var block = blocksResults[i];
      var blockJson = JSON.stringify(block);
      var existingRow = document.getElementById('blockRow' + block.height);

      if (existingRow && existingRow.getAttribute('data-json') !== blockJson)
      {
          $(existingRow).replaceWith(getBlockRowElement(block, blockJson));
      }
      else if (!existingRow)
      {
        var blockElement = getBlockRowElement(block, blockJson);
        var inserted = false;
        var rows = $blocksRows.children().get();

        for (var f = 0; f < rows.length; f++)
        {
          var bHeight = parseInt(rows[f].getAttribute('data-height'));
          if (bHeight < block.height)
          {
              inserted = true;
              $(rows[f]).before(blockElement);
              break;
          }
        }

        if (!inserted)
        {
            $blocksRows.append(blockElement);
        }
      }
    }
    $("time.timeago").timeago();
    calcAvgHashRate();
    calcAvgSolveTime();
  }

  function calcAvgHashRate()
  {
    var sum = Difficulties.reduce(add, 0);

    function add(a, b) {
      return a + b;
    }

    var avgDiff = Math.round(sum / Difficulties.length);
    var avgHashRate = avgDiff / blockTargetInterval;
    
    updateText('avgDifficulty', getReadableDifficultyString(avgDiff, 2).toString());
    updateText('avgHashrate', getReadableHashRateString(avgDiff / blockTargetInterval));
    updateText('blockSolveTime', getReadableTime(lastStats.difficulty / avgHashRate));

  }
    
  function calcAvgSolveTime()
  { 
    ts = time_stamps.concat([]);
    ts.sort();
    var avg_solve_time = 0;
    var solveTime = 0;
    for (var i = 1; i < ts.length; i++)
    {
      solveTime += ts[i] - ts[i - 1];
    }
    avg_solve_time = solveTime / (ts.length - 1);
    updateText('avgSolveTime', getReadableTime(avg_solve_time));
  }
    
  //  Karbovanets MemPool Transactions
  function getPoolTransactions() {
    var xhrGetPool = $.ajax({
      url: api + '/json_rpc',
      method: "POST",
      data: JSON.stringify({
        jsonrpc: "2.0",
        id: "test",
        method: "f_mempool_json",
        params: {}
      }),
      dataType: 'json',
      cache: 'false',
      success: function(newdata) {
        if (typeof newdata.result !== "undefined")
        {
          var data = newdata.result.mempool;
          var totalAmount = 0;
          var totalFee = 0;
          var totalSize = 0;
          var txcount = 0;
          var txsRows = document.getElementById('mem_pool_rows');
          if (txsRows)
          {
            while (txsRows.firstChild)
            {
              txsRows.removeChild(txsRows.firstChild);
            }
          }

          for (var i = 0; i < data.length; i ++)
          {
            var tx = data[i];
              
            var row = document.createElement('tr');
            var columns =
              '<td>' + formatDate(tx.receiveTime) + '</td>' +
              '<td>' + getReadableCoins(tx.amount_out, 4, true) + '</td>' +
              // '<td>' + getReadableCoins(tx.fee, 4, true) + '</td>' +
              // '<td>' + formatBytes(parseInt(tx.size)) + '</td>' +
              '<td>' + formatPaymentLink(tx.hash) + '</td>';
            row.innerHTML = columns;
            $(txsRows).append(row);
            $(row).find('.mtx-ago').timeago('update', new Date(tx.receiveTime * 1000).toISOString());
            
            txcount = txcount + 1;
            totalAmount = tx.amount_out + totalAmount;
            totalFee = totalFee + tx.fee;
            totalSize = totalSize + tx.size;
          }

          updateText('mempool_count', txcount);
          updateText('mempool_amount', getReadableCoins(totalAmount,4));
          updateText('mempool_fees', getReadableCoins(totalFee, 9));
          updateText('mempool_sizes', formatBytes(parseInt(totalSize)));
        }
      }
    });
  }

  // Difficulty chart
  function displayDiffChart()
  {
    var ctx = document.getElementById("difficultyChart");
    var chartData = {
      //labels: [].concat(Blocks).reverse(),
      labels: [].concat(formatDate(Timestamps)).reverse(),
      datasets: [
        {
        data: [].concat(Blocks).reverse(),
        yAxisID: "Height",
        label: "Height",
        backgroundColor: "rgba(0,0,0,0)",
        borderColor: 'rgba(0,0,0,0)',
        borderWidth: 0,
        pointBorderWidth: 0,
        pointRadius: 0,
        pointHoverRadius: 0,
        pointHitRadius: 0,
        display: false
        },{
        data: [].concat(Difficulties).reverse(),
        yAxisID: "Difficulty",
        label: "Difficulty",
        backgroundColor: "rgba(220,220,220,0.2)",
        borderColor: '#2FA4E7',
        borderWidth: 2,
        pointColor : "#2FA4E7",
        pointBorderColor : "#2FA4E7",
        pointHighlightFill: "#2FA4E7",
        pointBackgroundColor: "#2FA4E7",
        pointBorderWidth: 2,
        pointRadius: 1,
        pointHoverRadius: 3,
        pointHitRadius: 20
        },{
        data: [].concat(Txses).reverse(),
        yAxisID: "Transactions",
        label: "Transactions",
        backgroundColor: "rgba(255,242,0,0.1)",
        borderColor: '#B5E61D',
        borderWidth: 1,
        pointColor : "#B5E61D",
        pointBorderColor : "#B5E61D",
        pointHighlightFill: "#B5E61D",
        pointBackgroundColor: "#B5E61D",
        pointBorderWidth: 1,
        pointRadius: 1,
        pointHoverRadius: 3,
        pointHitRadius: 20
        },{
        data: [].concat(Sizes).reverse(),
        yAxisID: "Sizes",
        label: "Size",
        backgroundColor: "rgba(65,172,0,0.1)",
        borderColor: '#99D9EA',
        borderWidth: 1,
        pointColor : "#99D9EA",
        pointBorderColor : "#99D9EA",
        pointHighlightFill: "#99D9EA",
        pointBackgroundColor: "#99D9EA",
        pointBorderWidth: 1,
        pointRadius: 1,
        pointHoverRadius: 3,
        pointHitRadius: 20
        }
      ]
    };

    var options =
    {
      responsive: true,
      maintainAspectRatio: false,
      elements: {
        line: {
          tension: 0
        }
      },
      title: {
        display: false
      },
      legend: {
        display: false
      },
      scales: {
        yAxes: [{
          id: 'Height',
          type: 'linear',
          position: 'left',
          scaleLabel: {
            display: false,
            labelString: 'Height'
          },
          gridLines: {
            display:false
          },
          ticks: {
            fontSize: 9,
            display:false
          },
          display: false
          },{
          id: 'Difficulty',
          type: 'linear',
          position: 'left',
          scaleLabel: {
            display: false,
            labelString: 'Difficulty'
          },
          gridLines: {
            display:false
          },
          ticks: {
            fontSize: 9,
            display:false
          },
          display: false
          },{
          id: 'Transactions',
          type: 'linear',
          position: 'right',
          scaleLabel: {
            display: false,
            labelString: 'Transactions'
          },
          gridLines: {
            display:false
          },
          ticks: {
            fontSize: 9,
            display:false
          },
          display: false
          },{
          id: 'Sizes',
          type: 'linear',
          position: 'right',
          scaleLabel: {
            display: false,
            labelString: 'Size'
          },
          gridLines: {
            display:false
          },
          ticks: {
            fontSize: 9,
            display:false
          },
          display: false
          }
        
        ],
        xAxes: [{
          type: "time",
          time: {
            parser: false,
            unit: 'minute',
            unitStepSize: 60,
            round: 'second',
            displayFormats:
            {
              'millisecond': 'SSS [ms]',
              'second': 'HH:mm:ss', // 11:20:01 AM
              'minute': 'HH:mm', // 11:20:01 AM
              'hour': 'HH:mm', // Sept 4, 5PM
              'day': 'MMM Do', // Sep 4 2015
              'week': 'll', // Week 46, or maybe "[W]WW - YYYY" ?
              'month': 'MMM YYYY', // Sept 2015
              'quarter': '[Q]Q - YYYY', // Q3
              'year': 'YYYY', // 2017
            },
          },
          gridLines: {
            display:false
          },
          ticks: {
            fontSize: 9,
            fontColor: "#CCC",
            autoSkip: true,
            //maxRotation: 90,
            //minRotation: 90
            //display:false
          }
          //display: false
        }]
      },
    }; 
      
    diffChart = new Chart(ctx,{
      type: 'line',
      data: chartData,
      options: options
    });
  }

  function refreshChart()
  {
    var brows   = $('#blocks_rows').children(),
    labels  = [],
    diffs   = [],
    sizes   = [],
    times   = [],
    heights = [],
    txsnr   = [];
    for (var i = 0; i < brows.length; i++)
    {
      var row = $(brows[i]);
      var label = row.data("json").height;
      var diff  = row.data("json").difficulty;
      var txses = row.data("json").tx_count;
      var size  = row.data("json").cumul_size;
      var time  = row.attr('data-dt');

      labels.push(label);
      diffs.push(diff);
      txsnr.push(txses);
      sizes.push(size);        
      times.push(time);        
    }

    if (diffChart != null)
    {
      diffChart.data.labels = times.reverse();
      diffChart.data.datasets[0].data = labels.reverse();
      diffChart.data.datasets[1].data = diffs.reverse();
      diffChart.data.datasets[2].data = txsnr.reverse();
      diffChart.data.datasets[3].data = sizes.reverse();
     
      diffChart.update();
    }
  }  

  function loadMoreChart()
  {
    //diffChart.data.labels = [].concat(Blocks).reverse();
    diffChart.data.labels = [].concat(Timestamps).reverse();
    diffChart.data.datasets[0].data = [].concat(Blocks).reverse();
    diffChart.data.datasets[1].data = [].concat(Difficulties).reverse();
    diffChart.data.datasets[2].data = [].concat(Txses).reverse();
    diffChart.data.datasets[3].data = [].concat(Sizes).reverse();
    diffChart.update();
  }

  function getReadableTime(seconds)
  {
    var units = [ [60, 'secs'], [60, 'mins'], [24, 'hrs'], [7, 'days'], [4, 'wks'], [12, 'months'], [1, 'yrs'] ];

    function formatAmounts(amount, unit)
    {
      var rounded = Math.round(amount);
      return '' + rounded + ' ' + unit + (rounded > 1 ? '' : '');
    }

    var amount = seconds;

    for (var i = 0; i < units.length; i++)
    {
      if (amount < units[i][0])
      {
          return formatAmounts(amount, units[i][1]);
      }

      amount = amount / units[i][0];
    }

    return formatAmounts(amount,  units[units.length - 1][1]);
  }

</script>

<script>
  // home.html

  // Check transaction key

  var xhrGetTransaction, xhrCheckTransactionByKey, xhrCheckTransactionByViewKey, transaction;
	var transactionHash = $("#transaction_hash");
	var privateKey = $("#private_key");
	var publicAddress = $("#public_address");

  // currentPage = {
  //   destroy: function(){
  //     if (xhrGetTransaction) xhrGetTransaction.abort();
  //     if (xhrCheckTransactionByKey) xhrCheckTransactionByKey.abort();
  //     if (xhrCheckTransactionByViewKey) xhrCheckTransactionByViewKey.abort();
  //   },
  //   init: function(){
  //   },
  //   update: function(){
  //   }
  // };

	$("#check_result").hide();
	$("#check_result_error").hide();
	
	$("#check_transaction").click(function() {

    // alert("check_transaction");

		$("#check_result").hide();
    $("#check_result_error").hide();
		$('#inputs_rows').empty();
		$('#outputs_rows').empty();
		$('#receivedAmount').empty();
		$('#transactionHash').empty();

		if(!transactionHash.val() || !privateKey.val() || !publicAddress.val())
    {
			alert("Please fill in all fields");
			return;
		}

		getTransaction();

	});

	function getTransaction()
  {
    if (xhrGetTransaction)
    {
      xhrGetTransaction.abort();
    }

		xhrGetTransaction = $.ajax({
			url: api + '/json_rpc',
			method: "POST",
			data: JSON.stringify({
				jsonrpc:"2.0",
				id: "test",
				method:"f_transaction_json",
				params: {
					hash: transactionHash.val()
				}
			}),
			dataType: 'json',
			cache: 'false',
			success: function(data)
      {
			  if (data.error)
        {
          $("#check_result_error").html(data.error.message);
          $("#check_result_error").show();
          // alert(data.error.message);
			  }
        else 
        {
          var tx = data.result;
          renderTransaction(tx);
          checkTxKey();
			  }
			}
		});
	}	
	
	function checkTxKey(){

		if (xhrCheckTransactionByKey)
    {
      xhrCheckTransactionByKey.abort();
    }

		xhrCheckTransactionByKey = $.ajax({
			url: api + '/json_rpc',
			method: "POST",
      async: false,
			data: JSON.stringify({
				jsonrpc:"2.0",
				id: "test",
				method:"check_tx_key",
				params: {
					txid: transactionHash.val(),
					txkey: privateKey.val(),
					address: publicAddress.val()
				}
			}),
			dataType: 'json',
			cache: 'false',
			success: function(data){

			  if (data.error)
        {
          $("#check_result_error").html(data.error.message);
          $("#check_result_error").show();
			  }
        else
        {
          var result = data.result;

          $("#receiverAddress").html(publicAddress.val());

          $("#receivedAmount").html(getReadableCoins(result.amount, 9));
          
          var outputResults = result.outputs;
          for (var i = 0; i < outputResults.length; i++)
          {
            $('#outputs_rows tr').each(function() {
              $this = $(this);

              if ($this.attr('data-k_image') === outputResults[i].target.data.key)
              {
                $this.addClass("success");
              }
            });				
          }
          $("#check_result").show();
			  }
			}
		});
	}
	
	function renderTransaction(transaction)
  {
    var details = transaction.txDetails;
    inputs = transaction.tx.vin;
    outputs = transaction.tx.vout;
    block = transaction.block;

    // updateText('transactionHash', details.hash);

    // if (block.hash){
    //   $('#confirmations').show();
    //   updateText('transaction.confirmations', lastStats.height - block.height);
    //   updateText('transaction.timestamp', formatDate(block.timestamp));
    //   $(".transaction-timeago").timeago('update', new Date(block.timestamp * 1000).toISOString());
    // }

    // updateText('transaction.amount_out', getReadableCoins(details.amount_out));
    // updateText('transaction.fee', getReadableCoins(details.fee));
    // updateText('transaction.mixin', details.mixin);

    // if (!details.mixin)
    // {
    //     $('#div_transaction_mixin').hide();
    // }
    // updateText('transaction.paymentId', details.paymentId);
    // updateText('transaction.paymentIdDecifer', hex2a(details.paymentId));
    // if (!details.paymentId)
    //     $('#div_transaction_paymentId').hide();
    // updateText('transaction.size', formatBytes(parseInt(details.size)));

    // if (!block.hash){
    //   $('#tx_block').hide();
    //   $('#tx_unconfirmed').show();
    // }

    // updateText('block.hash', block.hash);
    // updateText('block.height', block.height);
    // updateText('block.timestamp', formatDate(block.timestamp));
    
    // renderInputs(inputs);
    // renderOutputs(outputs);
	}

  function getInputCells(input)
  {
    return '<td>' + getReadableCoins(input.value.amount) + '</td>' +
            '<td>' + input.value.k_image + '</td>' + '<td>' + input.value.key_offsets + '</td>';
  }


  function getInputRowElement(input, jsonString)
  {
    var row = document.createElement('tr');
    row.setAttribute('data-json', jsonString);
    row.setAttribute('data-k_image', input.value.k_image);
    row.setAttribute('data-key_offsets', input.value.key_offsets);
    row.setAttribute('id', 'inputRow' + input.value.k_image);

    row.innerHTML = getInputCells(input);

    return row;
  }

  function renderInputs(inputResults)
  {
    var $inputsRows = $('#inputs_rows');

    for (var i = 0; i < inputResults.length; i++)
    {
      var input = inputResults[i];

      if (!input.value.amount)
      {
        continue;
      }

      var inputJson = JSON.stringify(input);

      var existingRow = document.getElementById('inputRow' + input.value.k_image);

      if (existingRow && existingRow.getAttribute('data-json') !== inputJson)
      {
        $(existingRow).replaceWith(getInputRowElement(input, inputJson));
      }
      else if (!existingRow)
      {
        var inputElement = getInputRowElement(input, inputJson);
        $inputsRows.append(inputElement);
      }
    }
  
    updateText('inputs_count', document.querySelectorAll('#inputs_rows tr').length);
  }


  function getOutputCells(output)
  {
    return '<td>' + getReadableCoins(output.amount) + '</td>' + '<td>' + output.target.data.key + '</td>';
  }


  function getOutputRowElement(output, jsonString)
  {
    var row = document.createElement('tr');
    row.setAttribute('data-json', jsonString);
    row.setAttribute('data-k_image', output.target.data.key);
    row.setAttribute('id', 'outputRow' + output.target.data.key);

    row.innerHTML = getOutputCells(output);

    return row;
  }

  function renderOutputs(outputResults)
  {

    var $outputsRows = $('#outputs_rows');

    for (var i = 0; i < outputResults.length; i++)
    {
      var output = outputResults[i];
      var outputJson = JSON.stringify(output);
      var existingRow = document.getElementById('outputRow' + output.target.data.key);

      if (existingRow && existingRow.getAttribute('data-json') !== outputJson)
      {
        $(existingRow).replaceWith(getOutputRowElement(output, outputJson));
      }
      else if (!existingRow)
      {
        var outputElement = getOutputRowElement(output, outputJson);
        $outputsRows.append(outputElement);
      }
    }
  
    updateText('outputs_count', document.querySelectorAll('#outputs_rows tr').length);
  }
	
	function wrongParamAlert(message)
  {
    $('#page').after(
      '<div class="alert alert-danger alert-dismissable fade in" style="position: fixed; right: 50px; top: 50px;">'+
      '<button type="button" class="close" ' + 
      'data-dismiss="alert" aria-hidden="true">' + 
      '&times;' + 
      '</button>' + 
      '<strong>' + message + '</strong><br />' +
      '</div>');
	}

</script> 

<script src="../js/Chart.bundle.min.js"></script>
